%!TEX root = CV_GIULIO_DE_MATTIA.tex
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{style_academic_fixed}[2025/08/21 Academic CV style - FIXED VERSION]

% ==========================================
% IMPORT SISTEMA CORRETTO
% ==========================================
\RequirePackage{styles/cv_commands_base}        % CONTRATTO BASE (definisce tutti i comandi)
\RequirePackage{styles/cv_geometry_academic}    % Layout accademico  
\RequirePackage{fontspec}                       % Font management

% ==========================================
% FONT SYSTEM CON FALLBACK ROBUSTO
% ==========================================

% Usa il sistema di fallback definito in cv_commands_base
\setfontswithfallback
  {TeX Gyre Termes}{Times New Roman}      % Serif: primario, fallback
  {TeX Gyre Heros}{Arial}                 % Sans: primario, fallback  
  {TeX Gyre Cursor}{Courier New}          % Mono: primario, fallback

% Math support per formule in pubblicazioni
\RequirePackage{amsmath,amsfonts,amssymb}

% ==========================================
% HEADER ACCADEMICO - Ridefinizione corretta
% ==========================================
\renewcommand{\makeheader}{
  \cvlog{Generating academic header}
  \validatedata  % Controlla che tutti i dati necessari siano definiti
  
  \begin{center}
    {\fontsize{22}{26}\selectfont\bfseries\@name}\\[0.3em]
    {\Large\itshape\@role}
  \end{center}
  \vspace{0.5em}
  
  \noindent
  \begin{center}
    \@city \quad|\quad \@phone \quad|\quad \@mail \\
    \ifx\@link\undefined\else\@link\fi
  \end{center}
  \vspace{1.2em}
}

% ==========================================
% SEZIONI ACCADEMICHE - Ridefinizioni corrette
% ==========================================

% Formattazione sezioni
\RequirePackage{titlesec}
\titleformat{\section}[block]
  {\Large\bfseries}
  {}
  {0pt}
  {}
  [\vspace{-0.2em}{\color{gray}\rule{\textwidth}{0.3pt}}\vspace{0.4em}]

% ==========================================
% RIDEFINIZIONE COMANDI ESISTENTI (non creazione ex novo)
% ==========================================

% Esperienza accademica dettagliata
\renewcommand{\experience}[4]{%
  \cvlog{Formatting academic experience}
  \noindent\textbf{#3} \hfill {\footnotesize #1}\\
  \textit{#2}\\[-2pt]
  \begin{itemize}[leftmargin=1.5em, topsep=2pt, itemsep=0pt] 
    #4 
  \end{itemize}
  \vspace{0.8em}
}

% Formazione accademica con supervisore
\newcommand{\education}[4]{%
  \cvlog{Formatting academic education}
  \noindent\textbf{#3} \hfill {\footnotesize #1}\\
  \textit{#2}\\[-1pt]
  \ifx\relax#4\relax\else
    {\small #4}\\
  \fi
  \vspace{0.5em}
}

% Eventi artistici con focus ricerca
\renewcommand{\artisticevent}[7]{%
  \cvlog{Formatting academic artistic event}
  \noindent\textbf{#4} \hfill {\footnotesize #1}\\
  \textit{#2} -- #3\\[-2pt]
  
  % Usa description invece di itemize per layout pi√π strutturato
  \begin{description}[leftmargin=2em, labelwidth=1.5em, itemsep=1pt]
    \item[Ruolo:] #6
    \item[Organico:] #5
    \ifx\relax#7\relax\else
    \item[Note:] #7
    \fi
  \end{description}
  \vspace{0.8em}
}

% Skills accademiche con categorizzazione
\renewcommand{\skills}[1]{%
  \cvlog{Formatting academic skills}
  \section*{Competenze di Ricerca}
  \begin{itemize}[leftmargin=1.2em, itemsep=1pt, topsep=3pt, parsep=0pt]
    #1
  \end{itemize}
}

% ==========================================
% COMANDI SPECIALIZZATI ACCADEMICI
% ==========================================

% Posizione accademica dettagliata (5 parametri)
\renewcommand{\academicposition}[5]{%
  \cvlog{Formatting academic position}
  \noindent\textbf{#3} \hfill {\footnotesize #1}\\
  \textit{#2}\\[-2pt]
  \ifx\relax#4\relax\else
    \textbf{Supervisore:} #4\\[-2pt]
  \fi
  \ifx\relax#5\relax\else
    \begin{itemize}[leftmargin=1.5em, topsep=2pt, itemsep=0pt] 
      #5 
    \end{itemize}
  \fi
  \vspace{0.8em}
}

% Pubblicazione scientifica (6 parametri)
\renewcommand{\publication}[6]{%
  \cvlog{Formatting publication}
  % #1=anno, #2=autori, #3=titolo, #4=venue, #5=tipo, #6=note
  \noindent\textbf{#2} (#1). ``#3''. \textit{#4}. #5.
  \ifx\relax#6\relax\else
    \\{\footnotesize #6}
  \fi
  \par\vspace{0.3em}
}

% ==========================================
% VALIDAZIONE SPECIFICA ACADEMIC
% ==========================================

% Override della validazione base per includere controlli academic-specific
\renewcommand{\validatedata}{
  \@ifundefined{@name}{\PackageError{style_academic}{Name not defined. Use \\name{...}}{}}{}
  \@ifundefined{@role}{\PackageError{style_academic}{Role not defined. Use \\role{...}}{}}{}
  \@ifundefined{@city}{\PackageError{style_academic}{Contacts not defined. Use \\contacts{...}}{}}{}
  
  % Log successful validation
  \cvlog{Academic style validation passed}
}

% ==========================================
% FINE DEL PACKAGE
% ==========================================

% Log caricamento completato
\cvlog{Academic style loaded successfully}